{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar eosjs_1 = require(\"eosjs\");\n\nvar v4_1 = __importDefault(require(\"uuid/v4\"));\n\nvar stateContainer_1 = require(\"./stateContainer\");\n\nvar util_1 = require(\"./util\");\n\nvar DEFAULT_STATE = {\n  connecting: false,\n  connected: false,\n  connectionError: false,\n  connectionErrorMessage: void 0,\n  auth: void 0,\n  authenticating: false,\n  authenticated: false,\n  authenticationConfirmed: false,\n  authenticationError: false,\n  authenticationErrorMessage: void 0,\n  accountInfo: void 0,\n  accountFetching: false,\n  accountFetchError: false,\n  accountFetchErrorMessage: void 0\n};\n\nfunction initWallet(walletProvider, ctx) {\n  var _instanceId = v4_1.default();\n\n  var _stateContainer = stateContainer_1.makeStateContainer(__assign({}, DEFAULT_STATE)); //let discoverData: DiscoveryData = { keyToAccountMap: [], keys: [] };\n\n\n  var discoverData = {\n    keyToAccountMap: []\n  };\n  var counter = 0;\n  var getState = _stateContainer.getState;\n  var eosApi = new eosjs_1.Api({\n    // Api() constructor requires a JsonRpc - even if we dont want one for non-eos, so create empty JsonRpc here\n    rpc: ctx.eosRpc ? ctx.eosRpc : new eosjs_1.JsonRpc(''),\n    chainId: ctx.network.chainId,\n    signatureProvider: walletProvider.signatureProvider\n  }); // Account helpers\n\n  function fetchAccountInfo(accountName) {\n    if (!accountName) {\n      return Promise.reject('No `accountName` was passed in order to fetch the account info');\n    }\n\n    _stateContainer.updateState(function (state) {\n      return __assign({}, state, {\n        accountFetching: true,\n        accountFetchError: false,\n        accountFetchErrorMessage: void 0\n      });\n    }); // NonEOS Support: if ctx.eosRpc is undefined,\n    // return AccountInfo with just accountName\n\n\n    if (!ctx.eosRpc) {\n      var accountInfo_1 = {\n        name: accountName\n      };\n\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          accountFetching: false,\n          accountInfo: accountInfo_1\n        });\n      });\n\n      return Promise.resolve(accountInfo_1);\n    }\n\n    return ctx.eosRpc.get_account(accountName).then(function (accountData) {\n      var accountInfo = __assign({}, accountData);\n\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          accountFetching: false,\n          accountInfo: accountInfo\n        });\n      });\n\n      return accountInfo;\n    }).catch(function (error) {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          accountFetching: false,\n          accountInfo: void 0,\n          accountFetchError: true,\n          accountFetchErrorMessage: util_1.getErrorMessage(error)\n        });\n      });\n\n      return Promise.reject(error);\n    });\n  } // Connection\n\n\n  function connect() {\n    _stateContainer.updateState(function (state) {\n      return __assign({}, state, {\n        connected: false,\n        connecting: true,\n        connectionError: false,\n        connectionErrorMessage: void 0\n      });\n    });\n\n    return walletProvider.connect(ctx.appName).then(function () {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          connecting: false,\n          connected: true\n        });\n      });\n\n      return true;\n    }).catch(function (error) {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          connecting: false,\n          connectionError: true,\n          connectionErrorMessage: util_1.getErrorMessage(error)\n        });\n      });\n\n      return Promise.reject(error);\n    });\n  }\n\n  function discover(discoveryOptions) {\n    return __awaiter(this, void 0, void 0, function () {\n      var accountsDataObjToMerge, discoverResult;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            accountsDataObjToMerge = {\n              keyToAccountMap: []\n            };\n            return [4\n            /*yield*/\n            , walletProvider.discover(discoveryOptions).then(function (walletDiscoveryData) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var modifiedData, promises, _loop_1, _i, _a, keyData;\n\n                var _this = this;\n\n                return __generator(this, function (_b) {\n                  switch (_b.label) {\n                    case 0:\n                      console.log('walletDiscoveryData');\n                      console.log(walletDiscoveryData); //Merge any properties that were returned from the wallets specific discovery process. This allows the wallet to add custom properties to the response if needed.\n\n                      accountsDataObjToMerge = __assign({}, accountsDataObjToMerge, walletDiscoveryData);\n                      delete accountsDataObjToMerge.keys; // let keys: string[] = []; // If the discover fuction in the wallet doesn't return any keys we know the login function is going to have to prompt the user to select one.\n                      // if (walletDiscoveryData.keys) {\n                      // \tkeys = walletDiscoveryData.keys;\n                      // }\n                      // A callback of this kind can be supplied to the discover function, which will allow the caller to modify the list of keys before the account lookup process happens. \n                      // The feature was added so that key returned from the Ledger device can be modified to have a ENU prefix when in use with the the enumivo chain \n\n                      if (discoveryOptions.keyModifierFunc !== undefined) {\n                        modifiedData = discoveryOptions.keyModifierFunc(walletDiscoveryData);\n                        walletDiscoveryData = modifiedData;\n                      }\n\n                      if (!(discoveryOptions.keyLookupFunc !== undefined)) return [3\n                      /*break*/\n                      , 1]; // discoveryOptions.keyLookupFunc(walletDiscoveryData);\n\n                      discoveryOptions.keyLookupFunc(walletDiscoveryData, function (discoveredAccounts) {\n                        accountsDataObjToMerge.keyToAccountMap = discoveredAccounts;\n                        console.log('accountsDataObjToMerge(keyLookupFunc)');\n                        console.log({\n                          accountsDataObjToMerge: accountsDataObjToMerge\n                        });\n                        return Promise.resolve({\n                          accountsDataObjToMerge: accountsDataObjToMerge\n                        });\n                      });\n                      return [3\n                      /*break*/\n                      , 3];\n\n                    case 1:\n                      promises = [];\n\n                      _loop_1 = function (keyData) {\n                        var key = keyData.key;\n                        var keyIndex = keyData.index;\n                        var cached = false;\n\n                        if (discoverData.keyToAccountMap) {\n                          var foundInCache = discoverData.keyToAccountMap.findIndex(function (y) {\n                            return y.index == keyIndex;\n                          });\n                          if (foundInCache > -1) cached = true;\n                        }\n\n                        if (key && !cached && ctx.eosRpc) {\n                          var p = ctx.eosRpc.history_get_key_accounts(key).then(function (accountData) {\n                            return __awaiter(_this, void 0, void 0, function () {\n                              var accountEntry, _loop_2, _i, _a, account;\n\n                              var _this = this;\n\n                              return __generator(this, function (_b) {\n                                switch (_b.label) {\n                                  case 0:\n                                    accountEntry = {\n                                      index: keyIndex,\n                                      key: key,\n                                      accounts: []\n                                    };\n                                    if (!(accountData.account_names.length > 0)) return [3\n                                    /*break*/\n                                    , 4];\n\n                                    _loop_2 = function (account) {\n                                      return __generator(this, function (_a) {\n                                        switch (_a.label) {\n                                          case 0:\n                                            return [4\n                                            /*yield*/\n                                            , ctx.eosRpc.get_account(account).then(function (accountInfo) {\n                                              return __awaiter(_this, void 0, void 0, function () {\n                                                var _i, _a, permission, _b, _c, permissionKey;\n\n                                                return __generator(this, function (_d) {\n                                                  for (_i = 0, _a = accountInfo.permissions; _i < _a.length; _i++) {\n                                                    permission = _a[_i];\n\n                                                    for (_b = 0, _c = permission.required_auth.keys; _b < _c.length; _b++) {\n                                                      permissionKey = _c[_b];\n\n                                                      if (permissionKey.key == key) {\n                                                        accountEntry.accounts.push({\n                                                          account: account,\n                                                          authorization: permission.perm_name\n                                                        });\n                                                      }\n                                                    }\n                                                  }\n\n                                                  return [2\n                                                  /*return*/\n                                                  ];\n                                                });\n                                              });\n                                            })];\n\n                                          case 1:\n                                            _a.sent();\n\n                                            return [2\n                                            /*return*/\n                                            ];\n                                        }\n                                      });\n                                    };\n\n                                    _i = 0, _a = accountData.account_names;\n                                    _b.label = 1;\n\n                                  case 1:\n                                    if (!(_i < _a.length)) return [3\n                                    /*break*/\n                                    , 4];\n                                    account = _a[_i];\n                                    return [5\n                                    /*yield**/\n                                    , _loop_2(account)];\n\n                                  case 2:\n                                    _b.sent();\n\n                                    _b.label = 3;\n\n                                  case 3:\n                                    _i++;\n                                    return [3\n                                    /*break*/\n                                    , 1];\n\n                                  case 4:\n                                    return [2\n                                    /*return*/\n                                    , accountEntry];\n                                }\n                              });\n                            });\n                          });\n                          promises.push(p);\n                        }\n                      };\n\n                      for (_i = 0, _a = walletDiscoveryData.keys; _i < _a.length; _i++) {\n                        keyData = _a[_i];\n\n                        _loop_1(keyData);\n                      }\n\n                      return [4\n                      /*yield*/\n                      , Promise.all(promises).then(function (results) {\n                        accountsDataObjToMerge.keyToAccountMap = results || [];\n                        console.log('accountsDataObjToMerge');\n                        console.log({\n                          accountsDataObjToMerge: accountsDataObjToMerge\n                        });\n                        return Promise.resolve({\n                          accountsDataObjToMerge: accountsDataObjToMerge\n                        });\n                      })];\n\n                    case 2:\n                      _b.sent();\n\n                      _b.label = 3;\n\n                    case 3:\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            })];\n\n          case 1:\n            discoverResult = _a.sent();\n            counter++;\n\n            if (discoverData.keyToAccountMap.length == 0) {\n              discoverData = __assign({}, discoverData, accountsDataObjToMerge);\n            } else {\n              accountsDataObjToMerge.keyToAccountMap.forEach(function (newKey) {\n                discoverData.keyToAccountMap.push(newKey); // discoverData.keys = accountsDataObjToMerge.keys;\n              });\n            } // console.log(discoverData);\n\n\n            return [2\n            /*return*/\n            , Promise.resolve(discoverData)];\n        }\n      });\n    });\n  }\n\n  function disconnect() {\n    return walletProvider.disconnect().then(function () {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          connecting: false,\n          connected: false,\n          connectionError: false,\n          connectionErrorMessage: void 0\n        });\n      });\n\n      return true;\n    });\n  } // Authentication\n\n\n  function login(accountName, authorization) {\n    _stateContainer.updateState(function (state) {\n      return __assign({}, state, {\n        accountInfo: void 0,\n        authenticated: false,\n        authenticationConfirmed: false,\n        authenticating: true,\n        authenticationError: false,\n        authenticationErrorMessage: void 0\n      });\n    });\n\n    var index = -1;\n    var key = undefined; //If we've done discovery then we should be able to find the account trying to login in the discoverData\n\n    if (discoverData.keyToAccountMap.length > 0) {\n      // console.log('see if we can find ' + accountName + ' ' + authorization);\n      if (accountName && authorization) {\n        discoverData.keyToAccountMap.forEach(function (indexObj) {\n          var found = indexObj.accounts.find(function (account) {\n            return account.account == accountName && account.authorization == authorization;\n          });\n\n          if (found) {\n            index = indexObj.index;\n            key = indexObj.key;\n          }\n        });\n      }\n\n      if (!key) {\n        throw 'Loging was not able to determine the Key and Index for ' + authorization + '@' + accountName;\n      }\n    }\n\n    return walletProvider.login(accountName, authorization, index, key).then(function (walletAuth) {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          auth: walletAuth,\n          authenticated: true,\n          authenticating: false\n        });\n      });\n\n      return fetchAccountInfo(walletAuth.accountName);\n    }).then(function (accountInfo) {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          accountInfo: accountInfo\n        });\n      });\n\n      return accountInfo;\n    }).catch(function (error) {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          authenticating: false,\n          authenticationError: true,\n          authenticationErrorMessage: util_1.getErrorMessage(error)\n        });\n      });\n\n      return Promise.reject(error);\n    });\n  }\n\n  function logout() {\n    return walletProvider.logout().then(function () {\n      _stateContainer.updateState(function (state) {\n        return __assign({}, state, {\n          accountInfo: void 0,\n          authenticating: false,\n          authenticated: false,\n          authenticationError: false,\n          authenticationErrorMessage: void 0\n        });\n      });\n\n      return true;\n    });\n  }\n\n  function signArbitrary(data, userMessage) {\n    return walletProvider.signArbitrary(data, userMessage);\n  }\n\n  var wallet = {\n    _instanceId: _instanceId,\n    ctx: ctx,\n    provider: walletProvider,\n    eosApi: eosApi,\n\n    get state() {\n      return getState() || __assign({}, DEFAULT_STATE);\n    },\n\n    // Shortcut state accessors\n    get auth() {\n      var state = getState();\n      return state && state.auth || void 0;\n    },\n\n    get accountInfo() {\n      var state = getState();\n      return state && state.accountInfo || void 0;\n    },\n\n    get connected() {\n      var state = getState();\n      return state && state.connected || false;\n    },\n\n    get authenticated() {\n      var state = getState();\n      return state && state.authenticated || false;\n    },\n\n    get inProgress() {\n      var state = getState();\n      if (!state) return false;\n      var connecting = state.connecting,\n          authenticating = state.authenticating,\n          accountFetching = state.accountFetching;\n      return !!(connecting || authenticating || accountFetching);\n    },\n\n    get active() {\n      var state = getState();\n      if (!state) return false;\n      var connected = state.connected,\n          authenticated = state.authenticated,\n          accountInfo = state.accountInfo;\n      return !!(connected && authenticated && accountInfo);\n    },\n\n    get hasError() {\n      var state = getState();\n      if (!state) return false;\n      var connectionError = state.connectionError,\n          authenticationError = state.authenticationError,\n          accountFetchError = state.accountFetchError;\n      return !!(connectionError || authenticationError || accountFetchError);\n    },\n\n    get errorMessage() {\n      var state = getState();\n      if (!state) return void 0;\n      if (!wallet.hasError) return void 0;\n      var connectionErrorMessage = state.connectionErrorMessage,\n          authenticationErrorMessage = state.authenticationErrorMessage,\n          accountFetchErrorMessage = state.accountFetchErrorMessage;\n      return connectionErrorMessage || authenticationErrorMessage || accountFetchErrorMessage || 'Wallet connection error';\n    },\n\n    connect: connect,\n    discover: discover,\n    disconnect: disconnect,\n    login: login,\n    logout: logout,\n    fetchAccountInfo: fetchAccountInfo,\n    terminate: function () {\n      return logout().then(disconnect).then(function () {\n        ctx.detachWallet(wallet);\n        return true;\n      });\n    },\n    subscribe: function (listener) {\n      return _stateContainer.subscribe(listener);\n    },\n    signArbitrary: signArbitrary\n  };\n  return wallet;\n}\n\nexports.initWallet = initWallet;","map":{"version":3,"mappings":"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","names":["DEFAULT_STATE","connecting","connected","connectionError","connectionErrorMessage","auth","authenticating","authenticated","authenticationConfirmed","authenticationError","authenticationErrorMessage","accountInfo","accountFetching","accountFetchError","accountFetchErrorMessage","initWallet","walletProvider","ctx","_instanceId","v4_1","_stateContainer","stateContainer_1","__assign","discoverData","keyToAccountMap","counter","eosApi","eosjs_1","rpc","eosRpc","chainId","network","signatureProvider","fetchAccountInfo","accountName","Promise","reject","updateState","state","accountInfo_1","name","resolve","get_account","then","accountData","catch","error","util_1","connect","appName","discover","discoveryOptions","accountsDataObjToMerge","walletDiscoveryData","console","log","keys","keyModifierFunc","undefined","modifiedData","keyLookupFunc","discoveredAccounts","promises","keyData","key","keyIndex","index","cached","foundInCache","findIndex","y","p","history_get_key_accounts","accountEntry","accounts","account_names","length","account","_a","permissions","_i","permission","_c","required_auth","_b","permissionKey","push","authorization","perm_name","all","results","discoverResult","forEach","newKey","disconnect","login","indexObj","found","find","walletAuth","logout","signArbitrary","data","userMessage","wallet","provider","getState","inProgress","active","hasError","errorMessage","terminate","detachWallet","subscribe","listener","exports"],"sources":["../src/wallet.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}