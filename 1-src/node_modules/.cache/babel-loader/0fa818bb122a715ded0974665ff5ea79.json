{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar eosjs_1 = require(\"eosjs\");\n\nvar stateContainer_1 = require(\"./stateContainer\");\n\nvar wallet_1 = require(\"./wallet\");\n\nvar util_1 = require(\"./util\");\n\nvar DEFAULT_CONTEXT_STATE = {\n  wallets: []\n};\n\nfunction findProviderById(walletProviders, providerId) {\n  if (!walletProviders.length) return void 0;\n  return walletProviders.find(function (wp) {\n    return wp.id === providerId;\n  });\n}\n\nfunction initAccessContext(options) {\n  var appName = options.appName,\n      network = options.network,\n      isNotEosNetwork = options.isNotEosNetwork;\n  var _makeWalletProviderFns = options.walletProviders;\n\n  var walletProviders = _makeWalletProviderFns.map(function (makeWalletProvider) {\n    return makeWalletProvider(network);\n  });\n\n  var _stateContainer = stateContainer_1.makeStateContainer(DEFAULT_CONTEXT_STATE);\n\n  var _listeners = [];\n\n  function _handleUpdate() {\n    for (var _i = 0, _listeners_1 = _listeners; _i < _listeners_1.length; _i++) {\n      var listener = _listeners_1[_i];\n      listener(ctx);\n    }\n  }\n\n  var _walletUnsubscribeFns = new Map();\n\n  var stateUnsubscribe = _stateContainer.subscribe(_handleUpdate);\n\n  var eosRpc;\n\n  if (!isNotEosNetwork) {\n    var eosRpcUrl = util_1.getNetworkUrl(network);\n    eosRpc = new eosjs_1.JsonRpc(eosRpcUrl);\n  }\n\n  var ctx = {\n    appName: appName,\n    eosRpc: eosRpc,\n    network: network,\n    initWallet: function (walletProvider) {\n      var _walletProvider = typeof walletProvider === 'string' ? findProviderById(walletProviders, walletProvider) : walletProvider;\n\n      if (!_walletProvider) {\n        throw new Error(\"\\n          Cannot initiate a session, invalid wallet provider\\n          or wallet provider ID was passed\\n        \");\n      }\n\n      var newWallet = wallet_1.initWallet(_walletProvider, ctx);\n\n      _stateContainer.updateState(function (state) {\n        return {\n          wallets: (state && state.wallets || []).concat([newWallet])\n        };\n      }); // Subscribe to a new wallet updates immediately\n\n\n      _walletUnsubscribeFns.set(newWallet._instanceId, newWallet.subscribe(_handleUpdate));\n\n      return newWallet;\n    },\n    addWalletProvider: function (walletProvider) {\n      walletProviders.push(walletProvider(network));\n    },\n    getWalletProviders: function () {\n      return walletProviders;\n    },\n    getWallets: function () {\n      var state = _stateContainer.getState();\n\n      if (!state) return [];\n      return state.wallets || [];\n    },\n    getActiveWallets: function () {\n      return ctx.getWallets().filter(function (wallet) {\n        return wallet.connected && wallet.authenticated;\n      });\n    },\n    detachWallet: function (wallet) {\n      _stateContainer.updateState(function (state) {\n        return {\n          wallets: (state && state.wallets || []).filter(function (w) {\n            return w !== wallet;\n          })\n        };\n      });\n\n      var _instanceId = wallet._instanceId;\n\n      if (_walletUnsubscribeFns.has(_instanceId)) {\n        var unsubscribe = _walletUnsubscribeFns.get(_instanceId);\n\n        if (typeof unsubscribe === 'function') unsubscribe();\n      }\n    },\n    logoutAll: function () {\n      return Promise.all(ctx.getWallets().map(function (wallet) {\n        return wallet.logout();\n      })).then(function () {\n        return true;\n      });\n    },\n    disconnectAll: function () {\n      return Promise.all(ctx.getWallets().map(function (wallet) {\n        return wallet.disconnect();\n      })).then(function () {\n        return true;\n      });\n    },\n    terminateAll: function () {\n      return Promise.all(ctx.getWallets().map(function (wallet) {\n        return wallet.terminate();\n      })).then(function () {\n        return true;\n      });\n    },\n    destroy: function () {\n      return ctx.terminateAll().then(function () {\n        stateUnsubscribe();\n\n        _walletUnsubscribeFns.forEach(function (unsubscribeFn) {\n          if (typeof unsubscribeFn === 'function') unsubscribeFn();\n        });\n\n        _listeners = [];\n      });\n    },\n    subscribe: function (listener) {\n      _listeners = _listeners.concat([listener]);\n      return function unsubscribe() {\n        _listeners = _listeners.filter(function (l) {\n          return l !== listener;\n        });\n      };\n    }\n  };\n  return ctx;\n}\n\nexports.initAccessContext = initAccessContext;","map":{"version":3,"mappings":"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","names":["DEFAULT_CONTEXT_STATE","wallets","findProviderById","walletProviders","providerId","length","find","wp","id","initAccessContext","options","network","isNotEosNetwork","_makeWalletProviderFns","map","makeWalletProvider","_stateContainer","stateContainer_1","_listeners","_handleUpdate","_i","listener","ctx","_walletUnsubscribeFns","Map","stateUnsubscribe","subscribe","eosRpc","eosRpcUrl","util_1","eosjs_1","appName","initWallet","walletProvider","_walletProvider","Error","newWallet","wallet_1","updateState","state","concat","set","_instanceId","addWalletProvider","push","getWalletProviders","getWallets","getState","getActiveWallets","filter","wallet","connected","authenticated","detachWallet","w","has","unsubscribe","get","logoutAll","Promise","all","logout","then","disconnectAll","disconnect","terminateAll","terminate","destroy","forEach","unsubscribeFn","l","exports"],"sources":["../src/walletAccessContext.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}